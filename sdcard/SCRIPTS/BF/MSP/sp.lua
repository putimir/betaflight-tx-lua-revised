LOCAL_SENSOR_ID=0x0D;REMOTE_SENSOR_ID=0x1B;REQUEST_FRAME_ID=0x30;REPLY_FRAME_ID=0x32;protocol.mspSend=function(a)local b=0;b=a[1]+bit32.lshift(a[2],8)local c=0;c=a[3]+bit32.lshift(a[4],8)+bit32.lshift(a[5],16)+bit32.lshift(a[6],24)logger.append(logger,":: SmartPort Push: ")logger.appendHex(logger,LOCAL_SENSOR_ID)logger.appendHex(logger,REQUEST_FRAME_ID)logger.appendHex(logger,b)logger.appendHex(logger,c)logger.append(logger,"\r\n")return sportTelemetryPush(LOCAL_SENSOR_ID,REQUEST_FRAME_ID,b,c)end;protocol.mspRead=function(d)return mspSendRequest(d,{})end;protocol.mspWrite=function(d,a)return mspSendRequest(d,a)end;protocol.mspPoll=function()local e,f,b,c=sportTelemetryPop()if e==REMOTE_SENSOR_ID and f==REPLY_FRAME_ID then local a={}a[1]=bit32.band(b,0xFF)b=bit32.rshift(b,8)a[2]=bit32.band(b,0xFF)a[3]=bit32.band(c,0xFF)c=bit32.rshift(c,8)a[4]=bit32.band(c,0xFF)c=bit32.rshift(c,8)a[5]=bit32.band(c,0xFF)c=bit32.rshift(c,8)a[6]=bit32.band(c,0xFF)return mspReceivedReply(a)end;return nil end
